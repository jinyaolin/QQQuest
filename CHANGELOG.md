# 更新日誌

所有重要的專案變更都會記錄在此檔案中。

格式基於 [Keep a Changelog](https://keepachangelog.com/zh-TW/1.0.0/)，
並遵循 [Semantic Versioning](https://semver.org/lang/zh-TW/)。

---

## [Unreleased]

### 開發中
- CUE 排程系統
- 時間碼同步

---

## [1.0.0] - 2025-12-02

### 🎉 正式版本發布

這是 QQQuest 的第一個正式版本，整合了所有核心功能並進行了全面優化。

### ✨ 新增功能

#### 🔌 保持喚醒動作（v0.3.0 後續）
- 新增「保持喚醒」動作類型
- 設置設備在接電源時不進入深度睡眠
- 支持 4 種模式（0-3）
- 使用 `settings put global stay_on_while_plugged_in` 命令

#### 🔧 設備管理改進
- 設備排序功能（向上/向下移動）
- 設備狀態重新定義（ONLINE/OFFLINE/NOT_CONNECTED）
- 移除序號顯示（使用 WiFi ADB，序號即 IP:Port）
- 設備卡片優化（統一高度、對齊）
- 排序按鈕優化（緊湊設計，尺寸為 1/2）

#### 🏠 房間管理改進
- 房間視圖功能（點擊房間名稱查看所有設備）
- 房間重新連接功能（並發處理，避免阻塞）
- 房間卡片優化（每行 2 個，增加寬度）
- 移除"台"單位顯示

#### ⚡ 並發處理優化
- 實現 `connect_batch()` - 批量並發連接設備
- 房間重新連接使用並發處理
- 10 倍性能提升（10 台設備從 150 秒降至 15 秒）

#### 💾 資料持久化改進
- 設備資料按 `sort_order` 排序保存
- 實現 `reorder_devices()` 方法
- JSON 文件按順序排列，便於閱讀

### 🔧 技術改進

#### 核心模組
- **core/adb_manager.py**
  - 新增 `execute_keep_awake()` 方法
  - 新增 `connect_batch()` 方法
  - 並發處理優化

- **core/device_registry.py**
  - 新增 `reorder_devices()` 方法
  - `get_all_devices()` 按 `sort_order` 排序返回

- **core/action.py**
  - 新增 `ActionType.KEEP_AWAKE` 枚舉值
  - 新增參數驗證方法

#### UI 改進
- 設備卡片統一高度和對齊
- 排序按鈕緊湊設計
- 房間卡片寬度優化
- 對話框關閉按鈕統一處理

### 🐛 Bug 修復

- 修復設備狀態同步問題（離線設備狀態正確保存）
- 修復房間重新連接順序阻塞問題（改為並發處理）
- 修復設備排序按鈕對齊問題
- 修復對話框關閉按鈕導致空白頁面問題
- 修復動作類型選擇不即時響應問題
- 修復頁面刷新後系統未初始化問題
- 修復 `UnboundLocalError` 錯誤

### 📚 文件整理

- 整理所有 .md 文件
- 更新 `README.md` 為完整安裝指南
- 更新 `FEATURES.md` 以反映實際功能
- 創建 `DEVELOPMENT_LOG.md` 開發日記
- 整理開發筆記到 `docs/development-notes/`

### 📊 程式碼統計

- 新增程式碼：約 500 行
- 修改檔案：10+ 個
- Linter 錯誤：0

### 🎯 版本里程碑

v1.0.0 標誌著 QQQuest 從 MVP 階段進入正式版本，包含：

- ✅ 完整的設備管理功能
- ✅ 完整的房間管理功能
- ✅ 完整的動作管理功能（7 種動作類型）
- ✅ 完整的系統設定功能
- ✅ 並發處理優化
- ✅ 完整的文檔

---

## [0.3.0] - 2025-12-01

### ✨ 新增功能

#### 🏠 房間管理（完整實現）

- **房間管理**：
  - 建立房間（名稱、說明、最大設備數量）
  - 編輯房間（修改所有屬性）
  - 刪除房間（設備不會被刪除）
  - 房間列表顯示（卡片式布局，每行 3 個）
  - 房間統計面板（房間總數、設備總數、有設備/空房間）
  
- **設備管理**：
  - 管理設備對話框（勾選式添加/移除）
  - 顯示設備當前所在房間
  - 智能設備轉移（無需確認，自動從舊房間移出）
  - 容量檢查（不超過房間上限）
  - 批量添加/移除設備
  - 設備在線/離線狀態顯示
  
- **批量執行動作**：
  - 選擇動作並執行到房間內所有在線設備
  - 執行進度和結果統計（成功/失敗數量）
  - 詳細結果展示（每台設備的執行狀態）
  - 自動更新動作執行統計
  - 跳過離線設備

- **房間卡片**：
  - 顯示房間名稱、說明
  - 設備數量統計（例如：3/5 台）
  - 在線/離線設備統計
  - 容量警告（房間已滿）
  - 操作選單（執行動作、管理設備、編輯、刪除）

### 🔧 技術改進

#### 核心模組
- **core/room.py** (新增，125 行)
  - Room 資料模型
  - 容量管理（is_full, capacity_text）
  - 設備管理方法（add_device, remove_device, has_device）
  - 時間戳記錄

- **core/room_registry.py** (新增，310 行)
  - RoomRegistry 管理類
  - CRUD 操作（創建、讀取、更新、刪除）
  - 設備轉移邏輯（自動從舊房間移出）
  - 統計功能（房間數、設備數）
  - TinyDB 持久化儲存

#### UI 頁面
- **pages/2_🏠_房間管理.py** (完全重寫，約 600 行)
  - 完整的房間管理介面
  - 5 個對話框（新增、編輯、刪除、管理設備、執行動作）
  - 房間卡片渲染
  - 統計面板
  - 批量執行功能
  - 響應式布局

### 💡 關鍵特性

#### 智能設備轉移
- 無需確認，但清楚標注設備當前所在房間
- 勾選已在其他房間的設備 = 自動轉移
- 取消勾選已在此房間的設備 = 移出房間

#### 容量管理
- 設定最大設備數量（0 = 無限制）
- 顯示容量：「3/5 台」或「3 台（無限制）」
- 超過容量時自動阻止
- 編輯時警告超量

#### 批量執行
- 選擇動作並執行到所有在線設備
- 顯示成功/失敗統計
- 詳細結果展示
- 自動更新動作統計

### 📚 文件

- 新增 `docs/ROOM_MANAGEMENT_IMPLEMENTATION.md` - 實現總結

### 📊 程式碼統計

- 新增程式碼：約 1,035 行
- 新增檔案：3 個
- 修改檔案：0 個
- Linter 錯誤：0

### ⚠️ 注意事項

- 設備轉移是立即生效的，沒有撤銷功能
- 刪除房間不會刪除設備，設備會變成「不屬於任何房間」
- 批量執行時離線設備會被跳過
- 編輯容量時，如果當前設備超過新上限會顯示警告

---

## [0.2.0] - 2025-12-01

### ✨ 新增功能

#### ⚡ 動作管理（完整實現）
- **6 種動作類型**（合併 v0.2.0 + v0.2.1）：
  1. ☀️ 喚醒設備 - 喚醒休眠中的設備
  2. 😴 休眠設備 - 讓設備進入休眠
  3. 🚀 執行程式 - 啟動指定應用（package + activity）
  4. 🛑 關閉程式 - 強制停止應用（force-stop / kill）
  5. 🔄 重啟應用 - 關閉後重新啟動應用
  6. ⌨️ 發送按鍵 - 發送任意按鍵事件（含常用按鍵預設）

- **動作管理**：
  - 建立可重複使用的動作
  - 為每個動作命名和說明
  - 每種動作有各自的參數設定
  - 參數驗證和格式檢查
  
- **執行管理**：
  - 選擇目標設備執行動作
  - 執行狀態即時反饋
  - 執行統計（次數、成功率、最後執行時間）
  - 執行歷史記錄
  
- **動作操作**：
  - 新增動作（模態對話框，根據類型顯示不同參數）
  - 編輯動作（保留原有參數）
  - 刪除動作（帶執行統計提醒）
  - 複製動作（快速創建類似動作）
  - 搜索動作（關鍵字搜索）
  - 篩選動作（按類型篩選）
  
- **統計面板**：
  - 動作總數
  - 總執行次數
  - 成功次數
  - 整體成功率
  - 個別動作成功率

- **UI 設計**：
  - 響應式卡片佈局（每行 2 個）
  - 參數詳情可展開查看
  - 統計資訊可視化
  - 常用按鍵快速選擇

### 🔧 技術改進

#### 核心模組
- **core/action.py** (新增)
  - Action 資料模型
  - ActionType 枚舉（6 種類型）
  - ActionParamsValidator 參數驗證器
  - COMMON_KEYCODES 常用按鍵定義

- **core/action_registry.py** (新增)
  - ActionRegistry 管理類
  - CRUD 操作（創建、讀取、更新、刪除）
  - 搜索和統計功能
  - 動作複製功能
  - TinyDB 持久化儲存

#### ADB 擴展
- **core/adb_manager.py** (+343 行)
  - execute_wake_up() - 喚醒設備
  - execute_sleep() - 休眠設備
  - execute_launch_app() - 啟動應用
  - execute_stop_app() - 關閉應用
  - execute_restart_app() - 重啟應用
  - execute_send_key() - 發送按鍵
  - execute_action() - 通用執行方法

#### UI 頁面
- **pages/3_⚡_動作管理.py** (完全重寫，762 行)
  - 完整的動作管理介面
  - 5 個對話框（新增、編輯、刪除、執行、設備選擇）
  - 搜索和篩選功能
  - 統計面板
  - 響應式卡片佈局

### 📚 文件

- 新增 `docs/ACTION_MANAGEMENT_DESIGN.md` - 功能設計分析
- 新增 `docs/ACTION_MANAGEMENT_IMPLEMENTATION.md` - 實現總結

### 📊 程式碼統計

- 新增程式碼：約 1,627 行
- 新增檔案：3 個
- 修改檔案：2 個
- Linter 錯誤：0

### ⚠️ 注意事項

- 休眠動作可能導致 Wi-Fi 斷開，需要重新喚醒才能連接
- 應用 package 名稱需要用戶自行查詢或獲取
- 某些驗證功能依賴 Android 命令，可能在部分設備上不可用

---

## [0.1.0] - 2025-12-01 (MVP Release)

### ✨ 新增功能

#### 📱 設備管理
- 手動添加設備（透過 IP 和 Port）
- 設備列表顯示（響應式多欄卡片佈局）
- 設備資訊編輯（代號、名稱、備註）
- 設備移除功能（帶確認對話框）
- 自動同步設備在線/離線狀態
- 設備詳細狀態監控：
  - 電池電量和充電狀態
  - 設備溫度
  - 運作時間（uptime）
  - 清醒/休眠狀態

#### 📺 設備監看
- 使用 scrcpy 實時監看設備畫面
- 低延遲（< 50ms）、高幀率（60fps）
- 完整鍵盤滑鼠控制
- 自訂視窗標題
- 預設禁用音訊轉發（避免關閉 Quest 聲音）

#### ⚙️ 系統設定
- scrcpy 監看參數設定：
  - 視訊位元率（2M - 32M）
  - 最大畫面寬度（480 - 3840）
  - 最大幀率（0 - 120 FPS）
  - 視窗大小和位置
  - 渲染驅動選擇
  - 布林選項（保持清醒、顯示觸控、全螢幕等）
  - 音訊轉發開關
- 截圖預覽參數設定：
  - 更新頻率（1-10 秒）
  - 預覽圖尺寸
  - JPEG 品質
  - 快取開關
- 設定匯入/匯出（JSON 格式）
- 重置為預設設定

#### 🎨 UI/UX 優化
- 響應式設備卡片佈局
- 對話框關閉按鈕隱藏（避免意外關閉）
- 標題錨點鏈接隱藏（界面更簡潔）
- 自動刷新機制（對話框開啟時暫停）
- 側邊欄預設折疊

### 🐛 Bug 修復

#### 設備管理
- 修復設備 ID 重複問題（改用 UUID）
- 修復重新連線按鈕無效問題（實現自動同步）
- 修復設備狀態超時問題（增加超時時間、實現批量查詢）
- 修復資料庫 JSON 序列化錯誤（排除 None 值）
- 修復資料庫重複資料問題

#### scrcpy
- 添加 `--no-audio` 參數，避免關閉 Quest 聲音
- 實現配置載入邏輯，支援自訂參數

#### UI
- 修復對話框因自動刷新而關閉的問題
- 隱藏對話框右上角關閉按鈕
- 隱藏設備卡片標題旁的錨點鏈接

### 🔧 技術改進

#### 核心架構
- 使用 Pydantic 進行資料驗證
- 使用 TinyDB 進行輕量級資料持久化
- 使用 Loguru 實現結構化日誌
- 實現設定分層（系統預設 + 使用者自訂）

#### 效能優化
- 批量查詢設備狀態（單一 ADB 命令）
- 實現狀態快取機制（降低 ADB 命令頻率）
- 優化自動刷新邏輯（對話框時暫停）

#### 程式碼品質
- 無 linter 錯誤
- 模組化設計
- 完整的錯誤處理
- 詳細的日誌記錄

### 📚 文件

- 新增 `README.md` - 專案說明和快速開始
- 新增 `START_HERE.md` - 新手入門指南
- 新增 `QUICK_START.md` - 快速開始指南
- 新增 `FEATURES.md` - 完整功能規格
- 新增 `ARCHITECTURE_EVALUATION.md` - 架構評估
- 新增 `CHANGELOG.md` - 更新日誌（本檔案）
- 整理開發筆記到 `docs/development-notes/`

### 🗑️ 移除

- 移除 USB 自動偵測功能（簡化系統）
- 刪除測試腳本（cleanup_duplicates.py, test_*.py 等）
- 刪除未使用的 ui/ 目錄
- 刪除 core/usb_monitor.py
- 歸檔開發過程文件到 docs/development-notes/

### 📦 依賴

#### 核心依賴
- `streamlit>=1.28.0` - Web 應用框架
- `pydantic>=2.0.0` - 資料驗證
- `tinydb>=4.8.0` - 輕量級資料庫
- `loguru>=0.7.0` - 日誌工具
- `pillow>=10.0.0` - 圖像處理
- `streamlit-autorefresh>=0.0.1` - 自動刷新組件
- `adb-shell>=0.4.4` - ADB Python 封裝
- `python-dotenv>=1.0.0` - 環境變數管理

#### 外部工具
- `adb` (Android Debug Bridge) - 設備連接
- `scrcpy` - 設備鏡像

### ⏳ 已知限制

- 房間管理功能尚未實現（開發中）
- 動作管理功能尚未實現（開發中）
- 時間碼同步功能尚未實現（開發中）
- CUE 排程功能尚未實現（開發中）
- 截圖預覽功能已實現 API，但尚未整合到 UI

### 🎯 下一版本計劃

#### v0.2.0 (計劃)
- [ ] 實現房間管理功能
- [ ] 實現基礎動作管理
- [ ] 整合截圖預覽到設備卡片
- [ ] 添加設備搜尋和過濾功能

#### v0.3.0 (計劃)
- [ ] 實現時間碼同步
- [ ] 實現 CUE 排程系統
- [ ] 添加批量操作功能

---

## 版本號規則

版本號格式：`主版本.次版本.修訂版本`

- **主版本**: 重大架構變更或不兼容的 API 變更
- **次版本**: 新功能添加，向後兼容
- **修訂版本**: Bug 修復，向後兼容

---

**[Unreleased]**: 尚未發布的變更
**[0.1.0]**: MVP 版本發布 - 2025-12-01


# 設備狀態監控功能說明

## ✨ 功能概述

現在設備卡片會顯示更豐富的即時狀態資訊，包括：

- 🔋 **電量百分比** + 充電狀態
- 🌡️ **設備溫度**（實時監控）
- 👁️ **運作狀態**（清醒/休眠）
- 📺 **螢幕狀態**（開啟/關閉）
- ⏱️ **開機時間**（連續運行時長）
- 🟢 **最後在線時間**

### 🚀 **高效批量查詢**

所有狀態資訊**僅用一個 ADB 命令**獲取，不會影響性能！

---

## 📊 設備卡片顯示

### **完整狀態顯示範例**

```
┌────────────────────────┐
│ 🟢 Q01          [⋮]   │
│────────────────────────│
│訓練室 A - Quest 3      │
│📶 WiFi                 │
│192.168.50.201:5555     │
│SN: 2G97..              │
│                        │
│ 🟢 電量：85% ⚡         │ 🟢 溫度：32.5°C
│                        │
│ 👁️ 清醒 📺            │ 🟢 剛剛在線
│                        │
│ ⏱️ 開機：3h 24m        │
│                        │
│📝 備註 ▼               │
│ 主要用於新手訓練        │
└────────────────────────┘
```

---

## 🎯 狀態指標說明

### 1. 電量狀態 🔋

**顯示格式**：`🟢 電量：85% ⚡`

- **數值**：0-100%
- **顏色指示器**：
  - 🟢 綠色：> 50%（電量充足）
  - 🟡 黃色：20-50%（電量中等）
  - 🔴 紅色：< 20%（電量低，需充電）
- **充電標記**：
  - ⚡ 閃電圖標 = 正在充電
  - 無圖標 = 未充電

---

### 2. 溫度狀態 🌡️

**顯示格式**：`🟢 溫度：32.5°C`

- **數值**：攝氏溫度（°C）
- **顏色指示器**：
  - 🟢 綠色：< 35°C（溫度正常）
  - 🟡 黃色：35-40°C（溫度略高）
  - 🔴 紅色：> 40°C（溫度過高）

**建議**：
- 溫度過高時建議停止使用或散熱
- Quest 設備長時間使用溫度會上升是正常現象
- 充電時溫度會略高

---

### 3. 運作狀態 👁️😴

**顯示格式**：
- `👁️ 清醒 📺` = 設備清醒，螢幕開啟（正在使用）
- `👁️ 清醒 📴` = 設備清醒，螢幕關閉（待機中）
- `😴 休眠中` = 設備休眠（省電模式）

**說明**：
- **清醒（Awake）**：設備可以立即響應操作
- **休眠（Asleep）**：設備進入深度睡眠，需喚醒才能操作
- **螢幕狀態**：
  - 📺 = 螢幕開啟
  - 📴 = 螢幕關閉

---

### 4. 開機時間 ⏱️

**顯示格式**：`⏱️ 開機：3h 24m`

- 顯示設備**連續運行時間**
- 僅在設備在線時顯示
- 格式：
  - 小於 1 小時：`25m`
  - 大於 1 小時：`3h 24m`

**用途**：
- 追蹤設備穩定性
- 判斷是否需要重啟設備
- 建議每 24 小時重啟一次以保持最佳性能

---

### 5. 最後在線時間 🟢🟡🔴

**顯示格式**：
- `🟢 剛剛在線` = < 1 分鐘前
- `🟡 5 分前` = 1-60 分鐘前
- `🔴 2 時前` = > 1 小時前

---

## ⚙️ 技術細節

### 批量狀態獲取

**一個命令獲取所有資訊**：

```bash
adb shell "
dumpsys battery | grep -E 'level:|temperature:|powered:' && 
echo '---POWER---' && 
dumpsys power | grep -E 'Display Power|mWakefulness=' && 
echo '---UPTIME---' && 
cat /proc/uptime | cut -d' ' -f1
"
```

**獲取的資訊**：
- ✅ 電池電量（level）
- ✅ 電池溫度（temperature）
- ✅ 充電狀態（powered）
- ✅ 螢幕狀態（Display Power）
- ✅ 清醒狀態（mWakefulness）
- ✅ 開機時間（uptime）

**執行時間**：約 0.5-1 秒（單個設備）

### 自動更新機制

1. **頁面自動刷新**（每 3 秒）
2. **檢查在線設備**
3. **批量獲取狀態**（僅在線設備）
4. **更新顯示**

### 資料保存策略

- **保存到資料庫**：
  - ✅ 電量（battery）
  - ✅ 溫度（temperature）
  - ✅ 充電狀態（is_charging）

- **僅緩存在 session_state**（不保存到資料庫）：
  - ℹ️ 清醒狀態（is_awake）
  - ℹ️ 螢幕狀態（is_screen_on）
  - ℹ️ 開機時間（uptime）

**原因**：這些狀態變化頻繁，不需要持久化保存。

---

## 🎯 使用場景

### 場景 1：訓練課程前檢查

**檢查清單**：
```
設備：Q01
✅ 電量：85%（充足）
✅ 溫度：28°C（正常）
✅ 狀態：清醒
✅ 開機：15m（剛啟動）

結論：設備狀態良好，可以開始課程
```

---

### 場景 2：設備異常檢測

**警示範例**：
```
設備：Q03
⚠️  電量：15%（需充電）
🔴 溫度：42°C（過高！）
😴 休眠中
⏱️ 開機：48h（需重啟）

結論：建議立即充電、散熱並重啟設備
```

---

### 場景 3：多設備管理

**批量檢視**：
```
┌─────┬────┬───────┬───────┬────────┐
│設備 │電量│ 溫度  │ 狀態  │ 開機   │
├─────┼────┼───────┼───────┼────────┤
│Q01  │85% │32°C   │👁️清醒 │3h 24m  │
│Q02  │92% │29°C   │👁️清醒 │1h 15m  │
│Q03  │15% │42°C   │😴休眠 │48h 00m │⚠️
│Q04  │68% │35°C   │👁️清醒 │6h 42m  │
└─────┴────┴───────┴───────┴────────┘

快速識別問題設備：Q03 需要處理
```

---

## 💡 最佳實踐

### 1. 定期檢查設備狀態

**建議頻率**：
- 每日：檢查電量和溫度
- 每週：檢查開機時間，必要時重啟
- 每月：檢查電池健康度

### 2. 溫度管理

**正常範圍**：25-35°C

**溫度過高時**：
1. 停止使用，讓設備散熱
2. 檢查通風環境
3. 避免在充電時大量使用
4. 考慮使用散熱設備

### 3. 電池維護

**最佳做法**：
- 保持電量在 20-80% 之間
- 避免完全放電
- 長期不用時保持 50% 電量
- 使用原廠充電器

### 4. 設備重啟建議

**何時重啟**：
- 開機時間 > 24 小時
- 溫度持續過高
- 性能下降或卡頓
- 連接不穩定

---

## 🧪 測試工具

### 測試腳本

```bash
cd /Users/jinyaolin/QQquest
source venv/bin/activate
python test_device_status.py
```

**輸出範例**：
```
============================================================
測試設備狀態批量獲取功能
============================================================

📱 找到 1 台設備

============================================================
📱 設備：Q02
   序號：2G97C5ZH4Z00CC
   IP：192.168.50.201:5555
   狀態：online

🔄 正在獲取設備詳細狀態...

📊 設備狀態資訊：
------------------------------------------------------------
  🔋 電量：85%
  🌡️  溫度：32.5°C
  ⚡ 充電：否
  📺 螢幕：開啟
  👁️  狀態：清醒
  ⏱️  開機：12345 秒 (3h 25m)

🔍 狀態評估：
------------------------------------------------------------
  ✅ 電量充足
  ✅ 溫度正常
  ✅ 設備清醒，螢幕開啟（正在使用）
```

---

## 🐛 故障排除

### 問題 1：狀態資訊不顯示

**可能原因**：
- 設備離線
- ADB 連接問題

**解決方法**：
1. 確認設備在線（🟢 圖標）
2. 嘗試重新連線
3. 查看日誌確認錯誤

---

### 問題 2：溫度顯示為 0°C

**可能原因**：
- 設備不支持溫度回報
- ADB 命令執行失敗

**解決方法**：
- 這是正常現象，部分設備不提供溫度資訊
- 檢查設備型號是否支持

---

### 問題 3：狀態更新延遲

**說明**：
- 狀態每 3 秒自動更新一次
- 這是正常的刷新間隔

**加快更新**：
- 手動刷新頁面（F5）
- 點擊任何功能觸發 rerun

---

## 📄 相關文件

- `core/adb_manager.py` - `get_device_status()` 方法
- `pages/1_📱_設備管理.py` - UI 顯示邏輯
- `test_device_status.py` - 測試腳本

---

**功能狀態**：✅ 已完成
**性能影響**：✅ 極小（單個命令批量查詢）
**版本**：v1.0.0
**日期**：2025-12-01


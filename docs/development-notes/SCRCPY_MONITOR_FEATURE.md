# scrcpy 設備監看功能說明

## ✨ 功能概述

現在可以直接從設備卡片的操作選單**啟動 scrcpy**，即時監看和控制 Quest 設備！

### 🎯 **功能特色**

- 📺 **一鍵啟動監看** - 點擊即開啟視窗
- 🖱️ **滑鼠控制** - 使用電腦滑鼠控制設備
- ⌨️ **鍵盤輸入** - 使用電腦鍵盤輸入文字
- 🔄 **即時畫面** - 低延遲的即時螢幕鏡像
- 📱 **多設備支援** - 可同時監看多台設備
- 🎨 **自訂視窗標題** - 顯示設備名稱

---

## 🚀 使用方法

### **步驟 1：確保 scrcpy 已安裝**

#### macOS
```bash
brew install scrcpy
```

#### Linux (Ubuntu/Debian)
```bash
sudo apt install scrcpy
```

#### Windows
下載並安裝：https://github.com/Genymobile/scrcpy/releases

---

### **步驟 2：在 UI 中啟動監看**

1. 進入「📱 設備管理」頁面
2. 找到要監看的設備（必須為**在線狀態** 🟢）
3. 點擊設備卡片右上角的「**⋮**」選單
4. 點擊「**📺 監看設備**」
5. ✅ scrcpy 視窗會自動彈出

---

### **步驟 3：使用 scrcpy**

**視窗會自動開啟**，顯示設備即時畫面：

```
┌─────────────────────────────────┐
│ Q01 - QQQuest Monitor      [×]  │ ← 視窗標題
├─────────────────────────────────┤
│                                 │
│                                 │
│        Quest 設備畫面            │
│        (即時鏡像)                │
│                                 │
│                                 │
└─────────────────────────────────┘
```

**控制方式**：
- 🖱️ **滑鼠左鍵** = 觸控螢幕
- 🖱️ **滑鼠滾輪** = 滑動
- ⌨️ **鍵盤** = 輸入文字
- **Ctrl+C** 或 **關閉視窗** = 結束監看

---

## ⚙️ scrcpy 設定

### **預設設定**

當你點擊「監看設備」時，系統會使用以下預設設定：

| 設定 | 值 | 說明 |
|------|-----|------|
| 位元率 | 8M | 視訊品質（8Mbps） |
| 最大解析度 | 1024 | 螢幕寬度最大 1024px |
| 保持清醒 | ✅ | 防止設備休眠 |
| 顯示觸控點 | ❌ | 不顯示觸控點 |

### **自訂設定**（進階）

如需調整設定，可修改 `core/adb_manager.py` 中的 `start_scrcpy()` 方法：

```python
options={
    'bitrate': '12M',           # 更高畫質
    'max_size': 1920,           # 更高解析度
    'stay_awake': True,         # 保持清醒
    'show_touches': True,       # 顯示觸控點
    'always_on_top': True,      # 視窗置頂
    'fullscreen': False,        # 全螢幕
}
```

---

## 🎯 使用場景

### **場景 1：遠端操作設備**

```
需求：設備在遠處，需要遠端檢查和操作

步驟：
1. 點擊「📺 監看設備」
2. 使用滑鼠操作設備 UI
3. 檢查應用程式狀態
4. 進行設定調整
```

---

### **場景 2：展示/教學**

```
需求：在電腦螢幕上展示 Quest 操作流程

步驟：
1. 啟動監看
2. 投影電腦畫面到大螢幕
3. 操作 Quest 時，觀眾可同步看到
4. 適合培訓和展示
```

---

### **場景 3：多設備監控**

```
需求：同時監看多台設備狀態

步驟：
1. 對設備 Q01 點擊「監看設備」→ 視窗 1 開啟
2. 對設備 Q02 點擊「監看設備」→ 視窗 2 開啟
3. 對設備 Q03 點擊「監看設備」→ 視窗 3 開啟
4. 排列視窗，同時監控所有設備
```

---

### **場景 4：偵錯和測試**

```
需求：測試應用時需要查看設備畫面

步驟：
1. 啟動監看
2. 在 Quest 上執行應用
3. 在電腦上即時看到畫面
4. 方便截圖和記錄
```

---

## 💡 scrcpy 快捷鍵

### **常用快捷鍵**

| 快捷鍵 | 功能 |
|--------|------|
| **Ctrl+C** | 關閉 scrcpy |
| **Ctrl+F** | 切換全螢幕 |
| **Ctrl+G** | 調整視窗大小 |
| **Ctrl+X** | 旋轉螢幕 |
| **Ctrl+S** | 截圖 |
| **Ctrl+O** | 關閉設備螢幕 |
| **Ctrl+P** | 開啟電源選單 |
| **Ctrl+N** | 展開通知欄 |
| **Ctrl+←/→** | 返回/主畫面 |

### **音量控制**

| 快捷鍵 | 功能 |
|--------|------|
| **Ctrl+↑** | 增加音量 |
| **Ctrl+↓** | 降低音量 |

---

## ⚠️ 注意事項

### 1. **設備必須在線**

- ❌ **離線設備**無法啟動監看
- ✅ **在線設備**（🟢）才能使用

### 2. **網路延遲**

- WiFi ADB 可能有延遲（取決於網路品質）
- 建議在**穩定的 WiFi 環境**下使用
- USB 連接延遲更低（但需要實體連接）

### 3. **性能影響**

- scrcpy 會消耗一些網路頻寬和 CPU
- 同時監看多台設備可能影響電腦效能
- 建議監看**不超過 4 台設備**

### 4. **權限要求**

- Quest 設備必須啟用「USB 調試」
- 首次連接可能需要在 Quest 上確認授權

---

## 🐛 故障排除

### **問題 1：點擊「監看設備」沒反應**

**可能原因**：
- scrcpy 未安裝

**解決方法**：
```bash
# macOS
brew install scrcpy

# Linux
sudo apt install scrcpy

# 驗證安裝
scrcpy --version
```

---

### **問題 2：視窗開啟後立即關閉**

**可能原因**：
- 設備連接不穩定
- ADB 權限問題

**解決方法**：
1. 確認設備在線（🟢）
2. 嘗試重新連線設備
3. 在 Quest 上重新授權 USB 調試

---

### **問題 3：畫面延遲或卡頓**

**可能原因**：
- 網路頻寬不足
- WiFi 信號不穩定

**解決方法**：
1. 降低解析度（修改 `max_size` 為 720 或 480）
2. 降低位元率（修改 `bitrate` 為 4M 或 2M）
3. 使用 5GHz WiFi（如果可用）
4. 考慮使用 USB 連接

---

### **問題 4：無法控制設備**

**可能原因**：
- scrcpy 視窗失去焦點
- 設備鎖定

**解決方法**：
1. 點擊 scrcpy 視窗使其獲得焦點
2. 檢查 Quest 是否鎖定
3. 嘗試喚醒設備

---

## 🧪 測試工具

### **測試腳本**

```bash
cd /Users/jinyaolin/QQquest
source venv/bin/activate
python test_scrcpy.py
```

**測試腳本功能**：
1. 檢查 scrcpy 是否安裝
2. 列出所有在線設備
3. 選擇設備並啟動監看
4. 顯示使用說明

---

## 📊 技術細節

### **scrcpy 命令**

系統實際執行的命令：

```bash
scrcpy \
  -s 192.168.50.201:5555 \           # 指定設備
  --window-title "Q01 - QQQuest" \    # 視窗標題
  -b 8M \                             # 位元率
  -m 1024 \                           # 最大解析度
  --stay-awake                        # 保持清醒
```

### **進程管理**

- scrcpy 以**獨立進程**啟動（`start_new_session=True`）
- 關閉 QQQuest 應用**不會**關閉 scrcpy 視窗
- 每個設備的 scrcpy 是**獨立進程**

### **資源使用**

| 項目 | 預估 |
|------|------|
| CPU | 5-15% (每個視窗) |
| 記憶體 | 50-100 MB (每個視窗) |
| 網路頻寬 | 8 Mbps (每個視窗) |

---

## 🎨 進階功能（未來計劃）

### 可能的增強功能：

1. **批量監看**
   - 一鍵開啟房間內所有設備
   - 自動排列視窗

2. **錄影功能**
   - 錄製設備畫面
   - 保存為 MP4 文件

3. **自訂快捷鍵**
   - 設定常用操作的快捷鍵
   - 批量操作多台設備

4. **畫質預設**
   - 高畫質（1080p, 12M）
   - 標準（1024p, 8M）
   - 省流量（720p, 4M）

---

## 📄 相關文件

- `core/adb_manager.py` - scrcpy 啟動邏輯
- `pages/1_📱_設備管理.py` - UI 按鈕和調用
- `test_scrcpy.py` - 測試腳本
- scrcpy 官方文檔：https://github.com/Genymobile/scrcpy

---

## 🔗 外部資源

- **scrcpy GitHub**：https://github.com/Genymobile/scrcpy
- **安裝指南**：https://github.com/Genymobile/scrcpy/blob/master/doc/README.md
- **快捷鍵列表**：https://github.com/Genymobile/scrcpy#shortcuts

---

**功能狀態**：✅ 已完成  
**版本**：v1.0.0  
**日期**：2025-12-01


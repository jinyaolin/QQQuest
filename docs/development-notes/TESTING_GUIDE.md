# 🧪 測試指南

## Phase 1 功能測試清單

### 1. 系統啟動測試

**測試步驟**：
```bash
cd /Users/jinyaolin/QQquest
./run.sh
```

**預期結果**：
- ✅ 虛擬環境成功建立
- ✅ 相依套件安裝完成
- ✅ Streamlit 應用啟動
- ✅ 瀏覽器自動開啟 http://localhost:8501
- ✅ 首頁顯示正常

**檢查項目**：
- [ ] 無 Python 錯誤
- [ ] 無 import 錯誤
- [ ] ADB 可用性檢查通過
- [ ] 系統狀態正確顯示

---

### 2. ADB 連接測試

**前置條件**：
- ADB 已安裝
- Quest 已開啟 USB 除錯

**測試步驟**：
```bash
# 在終端機執行
adb devices
```

**預期結果**：
```
List of devices attached
1WMHH123ABC456    device
```

**檢查項目**：
- [ ] ADB 正確識別設備
- [ ] 設備狀態為 "device"

---

### 3. 手動新增設備測試

**測試步驟**：
1. 前往「📱 設備管理」頁面
2. 點擊「➕ 新增設備」
3. 輸入 Quest 的 IP 地址（例如：192.168.1.100）
4. 輸入端口：5555
5. 輸入代號：TEST01
6. 點擊「連線」

**預期結果**：
- ✅ 顯示「正在連接設備...」
- ✅ 連接成功訊息
- ✅ 設備卡片出現
- ✅ 設備狀態為在線（🟢）
- ✅ 顯示電量和溫度

**檢查項目**：
- [ ] 連接成功
- [ ] 設備資訊正確
- [ ] 電量百分比顯示
- [ ] 溫度顯示
- [ ] 序號顯示

**如果失敗**：
1. 檢查 Quest 和電腦是否在同一網路
2. 檢查 Quest IP 是否正確
3. 檢查防火牆設定
4. 查看日誌：`logs/qqquest_*.log`

---

### 4. USB 自動偵測測試

**測試步驟**：
1. 確保應用正在運行
2. 前往「📱 設備管理」頁面
3. 使用 USB 線連接 Quest 到電腦
4. 在 Quest 中允許 USB 除錯
5. 等待 3-5 秒

**預期結果 - 新設備**：
- ✅ 彈出「偵測到新設備」對話框
- ✅ 顯示設備序號
- ✅ 可輸入設備代號
- ✅ 點擊「連接並記住」後：
  - 執行 adb tcpip 5555
  - 自動連接 WiFi ADB
  - 設備加入列表
  - 顯示成功通知

**預期結果 - 已知設備**：
- ✅ 自動識別設備
- ✅ 自動執行 adb tcpip 5555
- ✅ 自動連接 WiFi ADB
- ✅ 恢復設備代號和設定
- ✅ 顯示「設備 XX 已自動連接」

**檢查項目**：
- [ ] USB 插入後 3-5 秒內偵測到
- [ ] 新設備對話框正常顯示
- [ ] 已知設備自動連接
- [ ] WiFi ADB 連接成功
- [ ] 拔掉 USB 後仍可透過 WiFi 控制

**如果失敗**：
1. 檢查 `adb devices` 是否看到設備
2. 檢查 USB 線是否支援資料傳輸
3. 檢查日誌中的錯誤訊息
4. 重新插拔 USB

---

### 5. 設備卡片功能測試

**測試步驟**：
1. 在設備列表中找到設備卡片
2. 點擊右上角 ⋮ 選單

**測試各項功能**：

#### 5.1 查看序號
- 點擊「📋 查看序號」
- 應顯示完整序號

#### 5.2 中斷連線
- 點擊「🔌 中斷連線」
- 設備狀態變為離線（🔴）
- 選單變為「重新連線」

#### 5.3 重新連線
- 在離線設備上點擊「🔌 重新連線」
- 設備重新連接
- 狀態變為在線（🟢）

#### 5.4 移除設備
- 點擊「🗑️ 移除設備」
- 顯示確認對話框
- 點擊「確定移除」
- 設備從列表消失
- 資料庫中移除

**檢查項目**：
- [ ] 所有選單項目可點擊
- [ ] 中斷連線正常運作
- [ ] 重新連線正常運作
- [ ] 移除設備需要確認
- [ ] 移除後不再顯示

---

### 6. 設備狀態監控測試

**測試步驟**：
1. 連接設備
2. 觀察設備卡片顯示

**檢查項目**：
- [ ] 電量百分比顯示正確
- [ ] 溫度顯示正確（單位：°C）
- [ ] 低電量時顯示 ⚠️（< 20%）
- [ ] 高溫時顯示 ⚠️（> 40°C）
- [ ] 連線類型正確（🔌 USB / 📶 WiFi）
- [ ] 序號縮寫正確顯示

---

### 7. 資料持久化測試

**測試步驟**：
1. 新增至少 2 台設備
2. 設定不同的代號和備註
3. 關閉應用程式
4. 重新啟動應用程式

**預期結果**：
- ✅ 所有設備仍在列表中
- ✅ 代號和設定保留
- ✅ 設備序號記錄保存

**檢查檔案**：
```bash
cat data/devices.json
cat data/device_registry.json
```

**檢查項目**：
- [ ] devices.json 包含所有設備
- [ ] device_registry.json 包含序號記錄
- [ ] 重啟後設備列表完整
- [ ] 設定沒有遺失

---

### 8. 多設備測試

**測試步驟**：
1. 連接 3 台以上設備
2. 設定不同代號
3. 測試各設備獨立操作

**檢查項目**：
- [ ] 所有設備正確顯示
- [ ] 響應式網格佈局正常（3 欄）
- [ ] 每台設備獨立操作
- [ ] 不會互相干擾
- [ ] 狀態更新正確

---

### 9. UI 自動刷新測試

**測試步驟**：
1. 保持頁面開啟
2. 在終端執行 `adb disconnect <device>`
3. 等待 3 秒

**預期結果**：
- ✅ 頁面自動刷新
- ✅ 設備狀態更新為離線

**檢查項目**：
- [ ] 每 3 秒自動刷新
- [ ] 設備狀態即時更新
- [ ] 不會中斷使用者操作

---

### 10. 錯誤處理測試

#### 10.1 無效 IP 測試
- 輸入無效 IP：`999.999.999.999`
- 應顯示連接失敗訊息

#### 10.2 連接超時測試
- 輸入不存在的 IP：`192.168.1.254`
- 應在 10 秒後超時並顯示錯誤

#### 10.3 ADB 不可用測試
- 暫時移除 ADB 路徑
- 重啟應用
- 應顯示 ADB 不可用錯誤

**檢查項目**：
- [ ] 錯誤訊息友善易懂
- [ ] 不會崩潰
- [ ] 日誌記錄錯誤詳情

---

### 11. 日誌系統測試

**檢查日誌檔案**：
```bash
ls -la logs/
cat logs/qqquest_$(date +%Y-%m-%d).log
cat logs/errors_$(date +%Y-%m-% d).log
```

**檢查項目**：
- [ ] 日誌檔案自動建立
- [ ] 一般操作記錄在 qqquest_*.log
- [ ] 錯誤記錄在 errors_*.log
- [ ] 時間戳記正確
- [ ] 日誌格式清晰易讀

---

## 效能測試

### 負載測試
- 連接 10 台設備
- 觀察記憶體和 CPU 使用率
- 檢查響應速度

**預期標準**：
- 記憶體 < 500MB
- CPU < 20%
- UI 響應 < 1 秒

---

## 常見問題排查

### 問題：設備連接失敗
**排查步驟**：
1. `adb devices` 檢查設備
2. `ping <device_ip>` 測試網路
3. 查看 `logs/errors_*.log`
4. 檢查防火牆設定

### 問題：USB 偵測不工作
**排查步驟**：
1. `adb devices` 確認 USB 連接
2. 檢查 USB 線
3. 重新插拔
4. 查看日誌中的 USB Monitor 訊息

### 問題：頁面不刷新
**排查步驟**：
1. 檢查 `streamlit-autorefresh` 是否安裝
2. 清除瀏覽器快取
3. 重新載入頁面

---

## 測試報告範本

```
測試日期：________
測試人員：________
系統版本：Phase 1

[ ] 1. 系統啟動測試
[ ] 2. ADB 連接測試
[ ] 3. 手動新增設備測試
[ ] 4. USB 自動偵測測試
[ ] 5. 設備卡片功能測試
[ ] 6. 設備狀態監控測試
[ ] 7. 資料持久化測試
[ ] 8. 多設備測試
[ ] 9. UI 自動刷新測試
[ ] 10. 錯誤處理測試
[ ] 11. 日誌系統測試

發現問題：
1. ___________________
2. ___________________

測試結論：✅ 通過 / ❌ 未通過
```

---

**完成所有測試後，Phase 1 開發即完成！** 🎉

